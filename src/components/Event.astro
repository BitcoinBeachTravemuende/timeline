---
import { useTranslations } from "../i18n";
import type { EventType } from "../types";
import { type Event, type Lang } from "../types";
import { twJoin, twMerge } from 'tailwind-merge'

type Props = {
  event: Event;
  lang: Lang;
}

const {
  lang,
  event: { type: eventType, headline, date, description, block, link },
} = Astro.props;


const t = useTranslations(lang)

type ColorsByType = {
  [key in EventType]: string;
}

const bgColor: ColorsByType = {
  action: `bg-sky-400`,
  meetup: `bg-orange-400`,
  software: "bg-pink-500",
  cinema: "bg-yellow-500",
  misc: "bg-gray-400",
  unknown: "bg-gray-400",
};

const afterFromColor: ColorsByType = {
  action: `after:from-sky-400`,
  meetup: `after:from-orange-400`,
  software: "after:from-pink-500",
  cinema: "after:from-yellow-500",
  misc: "after:from-gray-400",
  unknown: "after:from-gray-400",
};

const beforeFromColor: ColorsByType = {
  action: `before:from-sky-400`,
  meetup: `before:from-orange-400`,
  software: "before:from-pink-500",
  cinema: "before:from-yellow-500",
  misc: "before:from-gray-400",
  unknown: "before:from-gray-400",
};

const borderColor: ColorsByType = {
  action: `border-sky-400`,
  meetup: `border-orange-400`,
  software: "border-pink-500",
  cinema: "border-yellow-500",
  misc: "border-gray-400",
  unknown: "border-gray-400",
};

const textColor: ColorsByType = {
  action: `text-sky-400`,
  meetup: `text-orange-400`,
  software: "text-pink-500",
  cinema: "text-yellow-500",
  misc: "text-gray-400",
  unknown: "text-gray-400",
};


---
<section class={twMerge(
  'flex w-full min-h-[20rem] odd:justify-start even:justify-end relative',
  "before:content-['']",
  'before:bg-gray-200 before:absolute before:left-1/2',
  'before:-ml-1 before:w-2 before:h-full before:z-10',
  'first:before:top-1/2 last:before:bottom-1/2',
  'group/w')}
  id={block.toString()}
  x-data="{ shown: false }" 
  x-intersect.full="shown = true"
  x-intersect:leave="shown = false"
  >
  <!-- event wrapper -->
  <div class="w-1/2 px-20 flex items-center relative"
  >
    <!-- detail dotted background -->
    <div class="absolute inset-0 dot-background bg-[length:7px_7px] bg-[position:-8.5px_-8.5px]"
    
    x-show="shown" 
    x-transition:enter="transition ease-out duration-600"
    x-transition:enter-start="opacity-0 "
    x-transition:enter-end="opacity-100"
    x-transition:leave="transition ease-out duration-600"
    x-transition:leave-start="opacity"
    x-transition:leave-end="opacity-0"
    ></div>
    <!-- event details -->
    <div class={twMerge("py-4 px-10 relative",
      'bg-white border-4 rounded-2xl w-full',
      borderColor[eventType],
      "before:content-[''], before:absolute before:h-0 before:w-0 before:top-1/2 before:-translate-y-1 before:border-8 before:border-transparent",
      "group-even/w:before:border-r-inherit group-even/w:before:left-0 group-even/w:before:-translate-x-5",
      "group-odd/w:before:border-l-inherit group-odd/w:before:right-0 group-odd/w:before:translate-x-5",
      "hover:shadow-lg hover:scale-105 ease",
      "group/d",
      )}
      x-bind:class="{ "shadow-lg": expanded }"

      x-show="shown" 
      x-transition:enter="transition ease-out duration-300"
      x-transition:enter-start="opacity-0 scale-90 group-odd/w:-translate-x-1/4 group-even/w:translate-x-1/3"
      x-transition:enter-end="opacity-100 scale-100 translate-x-0"
      x-transition:leave="transition ease-out duration-300"
      x-transition:leave-start="opacity-100 scale-100 -translate-x-0"
      x-transition:leave-end="opacity-0 scale-90 -translate-x-1/4"

      x-data="{ expanded: false }"
      @click="expanded = !expanded"
    >
      <h1 class={twMerge("cursor-pointer text-2xl leading-none uppercase font-semibold", textColor[eventType])}>{headline[lang]}</h1>
      <div x-show="expanded" x-collapse>
        <h2 class="text-gray-400 text-sm py-1">{date.toLocaleDateString([lang])}</h2>
        <p class="text-lg text-gray-500">{description[lang]}</p>
        <a class="underline inline-block mt-4" href={link}>Link</a>
      </div>
    </div>
  </div>
  <!-- block time -->
  <p class={twMerge(
    'absolute left-1/2 top-1/2 -translate-x-[50%] -translate-y-[50%] rounded-full',
    bgColor[eventType],
    'after:bg-gradient-to-b',
    'after:to-gray-200',
    afterFromColor[eventType],
    "after:content-[''] after:absolute after:bottom-0 after:left-1/2 after:-mx-1 after:h-8 after:translate-y-8 after:w-2", 
    "before:content-[''] before:absolute before:top-0 before:left-1/2 before:-mx-1 before:h-8 before:-translate-y-8 before:w-2", 
    'group-first/w:before:bg-none',
    'before:bg-gradient-to-t',
    'before:to-gray-200',
    beforeFromColor[eventType],
    'group-last/w:after:bg-none',
    'text-white z-20 px-3 py-1 text-lg ',
    'hover:scale-125 hover:shadow-md ease'
  )}

    x-show="shown" 
    x-transition:enter="transition ease-out duration-300"
    x-transition:enter-start="opacity-0 scale-50"
    x-transition:enter-end="opacity-100 scale-100"
    x-transition:leave="transition ease-out duration-300"
    x-transition:leave-start="opacity-100 scale-100"
    x-transition:leave-end="opacity-0 scale-50"
  
  >
    {block}
  </p>
</section>

<style>
  /* 
    dotted background shared by @Brotzky
    @see https://twitter.com/brotzky_/status/1734260180475617625
  */
  .dot-background {
    background-image: radial-gradient(#94a3b8 1px, transparent 0);
    mask-image: radial-gradient(ellipse at center, rgba(0, 0, 0, 1), transparent 60%);
  }
</style>
